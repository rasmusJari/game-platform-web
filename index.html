<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | GamingPlatformTest</title>

</head>

<body style="text-align: center; padding: 0; border: 0; margin: 0;">
<canvas id="unity-canvas"
        width=960
        height=600
        tabindex="-1"
        style="width: 960px; height: 600px;
               background: #231F20">
</canvas>


<script>
    console.log("HTML loaded");
</script>

<!-- Make unityInstance global -->
<script>
    let unityInstance = null;
</script>

<script src="Build/app.loader.js"></script>

<script>
    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        const meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content =
            'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.head.appendChild(meta);

        const canvas = document.querySelector("#unity-canvas");
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        canvas.style.position = "fixed";
        document.body.style.textAlign = "left";

    }

    createUnityInstance(document.querySelector("#unity-canvas"), {
        arguments: [],
        dataUrl: "Build/app.data.unityweb",
        frameworkUrl: "Build/app.framework.js.unityweb",
        codeUrl: "Build/app.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
    productName: "GamingPlatformTest",
    productVersion: "0.1.0",
    }).then((instance) => {
        unityInstance = instance;

        console.log("Unity instance ready");

    }).catch((message) => {
        alert(message);
    });
</script>

<!-- Pusher -->
<script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>

<script>
    const pusher = new Pusher("YOUR_PUSHER_KEY", {
        cluster: "eu"
    });

    console.log("Pusher initialized", pusher);

    function sendToUnity(method, data) {
        if (!unityInstance) {
            console.warn("Unity not ready, dropped:", method, data);
            return;
        }

        unityInstance.SendMessage(
            "PusherListener",
            method,
            JSON.stringify(data)
        );
    }

    // Game events
    const gameChannel = pusher.subscribe("game-round");

    gameChannel.bind("round-ended", (data) => {
        console.log("Pusher - round-ended", data);
        sendToUnity("OnRoundEnded", data);
    });

    // Server events
    const serverChannel = pusher.subscribe("server-status");

    serverChannel.bind("wake-up", (data) => {
        console.log("Pusher - wake-up", data);
        sendToUnity("OnServerWakeUp", data);
    });

    serverChannel.bind("tick", (data) => {
        console.log("Pusher - tick", data);
    });
</script>

</body>
</html>
